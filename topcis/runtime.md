# Что такое Runtime?

## Содержание

- [Интерпретатор JavaScript и реализация JavaScript](#интерпретатор-javascript-и-реализация-javascript)
- [Runtime](#runtime)
- [Источники данных](#источники-данных)

## Интерпретатор JavaScript и реализация JavaScript

> JavaScript — это интерпретируемый язык программирования. Это означает, что перед исполнением исходный код не компилируется в двоичный код.

> Интерпрета́ция — построчный анализ, обработка и выполнение исходного кода программы или запроса, в отличие от компиляции, где весь текст программы, перед запуском анализируется и транслируется в машинный или байт-код без её выполнения.

Если говорить об интерпретаторах, то они встроены в браузеры:

- Google chrome - V8
- Mozila firefox - Spider monkey
- Safari - JavascriptCore
- MS Edge - Chakra

Интерпретатор JavaScript (или `JavaScript Engine`) состоит (в основном) из:

- Куча (Memory Heap) - название структуры данных, с помощью которой реализована динамически распределяемая память приложения.
- Стек вызовов (Call Stack) - абстрактный тип данных, представляющий собой список элементов, организованных по принципу LIFO (англ. last in — first out, «последним пришёл — первым вышел»).

## Runtime

> Runtime - окружающая среда выполнения, которая включает в себя необходимые глобальные переменные или функции и т.д.

Можно сказать, что сам браузер в какой-то степени и есть `Runtime`, так как это набор инструментов для интерпретирования JavaScript, ну и конечно много чего другого, например: воспроизведения музыки и т.д.

То в чем работает Интерпретатор JavaScript (или `JavaScript Engine`) называется - `JavaScript Runtime Environment`

JavaScript Runtime Environment состоит из:

- Интерпретатор JavaScript (или `JavaScript Engine`)
- [Web APIs](https://developer.mozilla.org/ru/docs/Web/API) - список интерфейсов (то есть, типов объектов), которые вы можете использовать при разработке веб-приложения или сайта.
- [Event Loop](./event_loop.md)
- Callback queue - Очередь обратных вызовов или очередь сообщений

## Компиляция и интерпретация

Так как JavaScript интерпретируемый язык, то он конечно медленнее скомпилированных языков. Но, сейчас JavaScript выполняется по принципу - `Just-in-time (JIT)` (комбинация компиляции и интерпретации)

> При таком подходе весь код компилируется в машинный код и сразу же исполняется. То есть присутствуют два этапа обычной предварительной компиляции, но портируемого исполняемого файла нет. И исполнение происходит сразу же после компиляции.

Этапы JIT

1. Парсинг
1. Формирование Abstract Syntax Tree (AST) + проверки синтаксических ошибок
1. Компиляция - берётся сгенерированное AST и компилируется в машинный код
1. Оптимизация и рекомпиляция

> Все эти операции парсинга, компиляции и оптимизации выполняются в специальных потоках внутри движка, доступ к которым мы не можем получить из кода. То есть они отделены от основного потока, который управляет стеком вызовов, исполняющим наш код. В разных движках это реализовано немного по-разному, но в целом, именно так выглядит современная компиляция Just-in-time для JavaScript.

## Источники данных

- [Куча (память)](https://ru.wikipedia.org/wiki/%D0%9A%D1%83%D1%87%D0%B0_(%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C))
- [Основы внутреннего устройства JavaScript](https://habr.com/ru/company/alfa/blog/651005/)
- [Как работает JS: обзор движка, механизмов времени выполнения, стека вызовов](https://habr.com/ru/company/ruvds/blog/337042/)
- [Среда выполнения](https://ru.wikipedia.org/wiki/%D0%A1%D1%80%D0%B5%D0%B4%D0%B0_%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F)